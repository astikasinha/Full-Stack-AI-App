{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/astik/Downloads/astikachatbotapp/app/context/AppContext.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useAuth, useUser } from \"@clerk/nextjs\";\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nexport const AppContext = createContext();\r\nexport const useAppContext = () => useContext(AppContext);\r\n\r\nexport const AppContextProvider = ({ children }) => {\r\n  const { user } = useUser();\r\n  const { getToken } = useAuth();\r\n\r\n  const [chats, setChats] = useState([]);\r\n  const [selectedChat, setSelectedChat] = useState(null);\r\n\r\n  // Fetch user chats\r\n  const fetchUsersChats = async () => {\r\n    try {\r\n      if (!user) return;\r\n\r\n      const token = await getToken();\r\n      if (!token) {\r\n        toast.error(\"Unable to fetch auth token. Please try again.\");\r\n        return;\r\n      }\r\n\r\n      const { data } = await axios.get(\"/api/chat/get\", {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (data.success) {\r\n        const sortedChats = [...data.data].sort(\r\n          (a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)\r\n        );\r\n        setChats(sortedChats);\r\n        if (sortedChats.length > 0) setSelectedChat(sortedChats[0]);\r\n      } else {\r\n        toast.error(data.message);\r\n      }\r\n    } catch (error) {\r\n      toast.error(error?.response?.data?.message || error.message);\r\n    }\r\n  };\r\n\r\n  // Create new chat\r\n  const createNewChat = async () => {\r\n    try {\r\n      if (!user) return;\r\n\r\n      const token = await getToken(); // âœ… fetch token\r\n      console.log(\"Clerk token:\", token); // log after declaration\r\n\r\n      if (!token) {\r\n        toast.error(\"Unable to fetch auth token. Please try again.\");\r\n        return;\r\n      }\r\n\r\n      const { data } = await axios.post(\r\n        \"/api/chat/create\",\r\n        {},\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`, // send token to backend\r\n          },\r\n        }\r\n      );\r\n\r\n      if (data.success) {\r\n        await fetchUsersChats(); // refresh chats after creating new chat\r\n      } else {\r\n        toast.error(data.message);\r\n      }\r\n    } catch (error) {\r\n      toast.error(error?.response?.data?.message || error.message);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user) fetchUsersChats();\r\n  }, [user]);\r\n\r\n  const value = {\r\n    user,\r\n    chats,\r\n    setChats,\r\n    selectedChat,\r\n    setSelectedChat,\r\n    fetchUsersChats,\r\n    createNewChat,\r\n  };\r\n\r\n  return <AppContext.Provider value={value}>{children}</AppContext.Provider>;\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}}]
}